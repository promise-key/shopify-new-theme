{% comment %}
  Renders cart drawer

  Usage:
  {% render 'cart-drawer' %}
{% endcomment %}

<cart-drawer class="invisible{% if cart == empty %} is-empty{% endif %}">
  <div id="CartDrawer" class="fixed inset-0 h-full w-screen z-20 flex justify-end">
    <div id="CartDrawer-Overlay" class="fixed inset-0 bg-black/25 hidden"></div>
    <div class="relative max-w-lg w-full bg-contrast h-full grid grid-rows-[auto_1fr] grid-cols-[100%] overflow-y-auto transition-all duration-300 translate-x-full" role="dialog" aria-modal="true" aria-label="{{ 'sections.cart.title' | t }}" tabindex="-1">
      <div class="flex items-center px-6 h-nav sm:px-8 md:px-12 justify-between">
        <h2 class="whitespace-pre-wrap max-w-prose font-bold text-lead">{{ 'sections.cart.title' | t }}</h2>
        <button type="button" class="js-close-button p-4 -m-4 transition text-primary hover:text-primary/50" aria-label="{{ 'accessibility.close' | t }}">
          {%- render 'icon-close' -%}
        </button>
      </div>
      {%- if cart == empty -%}
        <div class="px-6 sm:px-8 md:px-12">
          <p class="text-copy">{{ 'sections.cart.empty' | t }}</p>
        </div>
      {%- endif -%}
      <cart-drawer-items{% if cart == empty %} class="is-empty"{% endif %}>
        <form action="{{ routes.cart_url }}" id="CartDrawer-Form" method="post">
          <div id="CartDrawer-CartItems" class="px-6 pb-6 sm-max:pt-2 md:px-12 grid gap-6 md:gap-10">
            {%- for item in cart.items -%}
              <div class="flex gap-4">
                <div class="relative flex-shrink">
                  {% if item.image %}
                    {% comment %} Leave empty space due to a:empty CSS display: none rule {% endcomment %}
                    <a href="{{ item.url }}" class="absolute inset-0 w-full h-full" tabindex="-1" aria-hidden="true"> </a>
                    <img class="object-cover object-center w-24 h-24 border rounded md:w-28 md:h-28"
                      src="{{ item.image | image_url: width: 300 }}"
                      alt="{{ item.image.alt | escape }}"
                      loading="lazy"
                      width="150"
                      height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}"
                    >
                  {% endif %}
                </div>
                <div class="flex justify-between flex-grow">
                  <div class="grid gap-2">
                    <h3 class="whitespace-pre-wrap max-w-prose font-medium text-copy"><a href="{{ item.url }}">{{ item.product.title | escape }}</a></h3>
                    {%- if item.product.has_only_default_variant == false or item.properties.size != 0 or item.selling_plan_allocation != nil -%}
                      <div class="pb-2">
                        <dl class="grid">
                          {%- if item.product.has_only_default_variant == false -%}
                            {%- for option in item.options_with_values -%}
                              <div class="flex max-w-prose whitespace-pre-wrap text-primary/50 text-copy">
                                <dt>{{ option.name }}: </dt>
                                <dd>{{ option.value }}</dd>
                              </div>
                            {%- endfor -%}
                          {%- endif -%}

                          {%- for property in item.properties -%}
                            {%- assign property_first_char = property.first | slice: 0 -%}
                            {%- if property.last != blank and property_first_char != '_' -%}
                              <div class="flex max-w-prose whitespace-pre-wrap text-primary/50 text-copy">
                                <dt>{{ property.first }}: </dt>
                                <dd>
                                  {%- if property.last contains '/uploads/' -%}
                                    <a href="{{ property.last }}" class="link" target="_blank" aria-describedby="a11y-new-window-message">
                                      {{ property.last | split: '/' | last }}
                                    </a>
                                  {%- else -%}
                                    {{ property.last }}
                                  {%- endif -%}
                                </dd>
                              </div>
                            {%- endif -%}
                          {%- endfor -%}
                        </dl>

                        <p class="flex max-w-prose whitespace-pre-wrap text-primary/50 text-copy">{{ item.selling_plan_allocation.selling_plan.name }}</p>
                      </div>
                    {%- endif -%}

                    <div class="flex items-center gap-2">
                      <quantity-input class="max-w-[107px] flex items-center border rounded">
                        <button class="w-10 h-10 transition text-primary/50 hover:text-primary disabled:cursor-wait shrink-0" type="button" name="minus" aria-label="{{ 'products.product.quantity.decrease' | t: product: item.product.title | escape }}">
                          &#8722;
                        </button>
                        <input class="p-0 w-full flex-grow bg-transparent border-0 text-center spin-button-none"
                          type="number"
                          name="updates[]"
                          value="{{ item.quantity }}"
                          min="0"
                          aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
                          id="Drawer-quantity-{{ item.index | plus: 1 }}"
                          data-index="{{ item.index | plus: 1 }}"
                        >
                        <button class="w-10 h-10 transition text-primary/50 hover:text-primary disabled:cursor-wait shrink-0" type="button" name="plus" aria-label="{{ 'products.product.quantity.increase' | t: product: item.product.title | escape }}">
                          &#43;
                        </button>
                      </quantity-input>

                      <cart-remove-button id="CartDrawer-Remove-{{ item.index | plus: 1 }}" data-index="{{ item.index | plus: 1 }}">
                        <button type="button" class="flex items-center justify-center w-10 h-10 border rounded" aria-label="{{ 'sections.cart.remove_title' | t: title: item.title }}">
                          {% render 'icon-remove' %}
                        </button>
                      </cart-remove-button>

                      <p aria-live="polite" data-cart-item-error></p>
                    </div>
                  </div>
                  <div class="max-w-prose whitespace-pre-wrap inherit text-copy"><span>{{ item.original_line_price | money }}</span></div>
                </div>
              </div>
            {%- endfor -%}
          </div>
        </form>
      </cart-drawer-items>
    </div>
  </div>
</cart-drawer>
